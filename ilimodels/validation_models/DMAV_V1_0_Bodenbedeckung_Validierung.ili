INTERLIS 2.4;

MODEL DMAV_V1_0_Bodenbedeckung_Validierung (de) 
AT "https://www.kgk-cgc.ch/" 
VERSION "2025-03-30" =
  
IMPORTS UNQUALIFIED INTERLIS;
IMPORTS UNQUALIFIED Text_V2;
IMPORTS UNQUALIFIED Math_V2_1;
IMPORTS UNQUALIFIED ObjectPool_V1_0;
IMPORTS UNQUALIFIED Elements_V1_0;
IMPORTS DMAVTYM_Topologie_V1_0;
IMPORTS DMAV_FixpunkteAVKategorie3_V1_0;
IMPORTS DMAV_Bodenbedeckung_V1_0;
IMPORTS DMAV_Einzelobjekte_V1_0;
IMPORTS DMAV_Nomenklatur_V1_0;
IMPORTS DMAV_Grundstuecke_V1_0;
IMPORTS DMAV_Rohrleitungen_V1_0;
IMPORTS DMAV_HoheitsgrenzenAV_V1_0;
IMPORTS DMAV_Toleranzstufen_V1_0;
IMPORTS DMAV_Gebaeudeadressen_V1_0;
IMPORTS KGKCGC_FPDS2_V1_1;
IMPORTS FixpunkteLV_V1_0;

    VIEW TOPIC Bodenbedeckung_Validierung = 
    DEPENDS ON DMAV_Bodenbedeckung_V1_0.Bodenbedeckung;
  
        VIEW v_Bodenbedeckung
            PROJECTION OF DMAV_Bodenbedeckung_V1_0.Bodenbedeckung.Bodenbedeckung;
        =
            ALL OF Bodenbedeckung; 
            
            !!@ ilivalid.check = warning
            !!@ ilivalid.msg="Flächenperimeter muss mit Referenzperimeter der Liegenschaften übereinstimmen (Toleranz 2 mm)";
            !!@ ilivalid.msg_de="Flächenperimeter muss mit Referenzperimeter der Liegenschaften übereinstimmen (Toleranz 2 mm)";
            !!@ ilivalid.msg_fr="Le périmètre doit être identique au périmètre de référence des biens-fonds (tolérance 2 mm)";
            !!@ ilivalid.msg_it="Il perimetro deve coincidere con il perimetro di riferimento del bene immobile (Tolleranza 2 mm)";
            !! AGI SH: Failcase umgesetzt;
            !! Kategorie: modellübergreifend
            !! Umsetzung Phase 2;
            SET CONSTRAINT CH043451: WHERE Objektstatus==#real: (
                   DMAVTYM_Topologie_V1_0.isGeometrySpatiallyEqual(ALL, >>Geometrie, ObjectPool_V1_0.filter(ObjectPool_V1_0.allObjects(>DMAV_Grundstuecke_V1_0.Grundstuecke.Liegenschaft), "DEFINED(Grundstueck->Entstehung) AND NOT(DEFINED(Grundstueck->Untergang))"), >>DMAV_Grundstuecke_V1_0.Grundstuecke.Liegenschaft->Geometrie, 0.002)
            );  

            !!@ ilivalid.msg="Gebäude hat keinen EGID";
            !!@ ilivalid.msg_de="Gebäude hat keinen EGID";
            !!@ ilivalid.msg_fr="Le bâtiment n'a pas d'EGID";
            !!@ ilivalid.msg_it="L'edificio non ha un EGID";
            !! AGI SH: Failcase umgesetzt;
            !! Kategorie: modellübergreifend
            !! Umsetzung Phase 2;
            MANDATORY CONSTRAINT CH043453 : (
                (Objektstatus == #real) AND (Bodenbedeckungsart == #Gebaeude) => DEFINED(EGID)
            ); 

            !!@ ilivalid.msg="Der gleiche EGID (Topic BB) wird für verschiedene Gebäude verwendet";
            !!@ ilivalid.msg_de="Der gleiche EGID (Topic BB) wird für verschiedene Gebäude verwendet";
            !!@ ilivalid.msg_fr="Le même EGID (topic CS) est renseigné pour plusieurs bâtiments différents";
            !!@ ilivalid.msg_it="Lo stesso EGID (topic CS) è assegnato a più edifici differenti";
            !! AGI SH: Failcase umgesetzt;
            !! Umsetzung Phase 1; -> Kommentar Romedi: Gilt nur innerhalb eines Operats. Vergleich eindeutige EGID in Gebäudenummer und Gebäudeeingang
            UNIQUE GWRA09 : WHERE Bodenbedeckungsart==#Gebaeude: EGID;

            !!@ ilivalid.msg="EGID existiert nicht im GWR";
            !!@ ilivalid.msg_de="EGID existiert nicht im GWR";
            !!@ ilivalid.msg_fr="L'EGID n'existe pas dans le RegBL";
            !!@ ilivalid.msg_it="L'EGID non esiste nel REA";
            !! Umsetzung Phase 3;
            /*
            MANDATORY CONSTRAINT GWRC02a WHERE DEFINED(EGID):
                 DMAV_GWR("C02");
            */

        END v_Bodenbedeckung;

        VIEW v_Messpunkt
            PROJECTION OF DMAV_Bodenbedeckung_V1_0.Bodenbedeckung.Messpunkt;
        =
            ALL OF Messpunkt;

            !!@ ilivalid.msg="Messpunkt darf kein Grenzpunkt, LFP1, LFP2 oder LFP3 sein";
            !!@ ilivalid.msg_de="Messpunkt darf kein Grenzpunkt, LFP1, LFP2 oder LFP3 sein";
            !!@ ilivalid.msg_fr="Le PointMesure ne doit pas être un point_limite, PFP1, PFP2 ou PFP3";
            !!@ ilivalid.msg_it="Il punto di misura non deve essere un punto limite, PFP1, PFP2 o PFP3";
            !! Kategorie: modellübergreifend & @geow Dienstbezug
            !! Umsetzung Phase 2;
            !! Failcase für Testsuite erstellt (Testsuite_DMAV/DMAV_V1_0_Validierung/DMAV_V1_0_Validierung.Bodenbedeckung_Validierung.v_Bodenbedeckung.CH043452)
            MANDATORY CONSTRAINT CH043452 : (
                NOT(DMAVTYM_Topologie_V1_0.pointInPoints(THIS, >>Geometrie, ObjectPool_V1_0.allObjects(>DMAV_FixpunkteAVKategorie3_V1_0.FixpunkteAVKategorie3.LFP3), >>DMAV_FixpunkteAVKategorie3_V1_0.FixpunkteAVKategorie3.LFP3->Geometrie))
                AND NOT(DMAVTYM_Topologie_V1_0.pointInPoints(THIS, >>Geometrie, ObjectPool_V1_0.allObjects(>DMAV_Grundstuecke_V1_0.Grundstuecke.Grenzpunkt), >>DMAV_Grundstuecke_V1_0.Grundstuecke.Grenzpunkt->Geometrie))
                AND NOT(DMAVTYM_Topologie_V1_0.pointInPoints(THIS, >>Geometrie, ObjectPool_V1_0.allObjects(>FixpunkteLV_V1_0.FixpunkteLV.LFP1), >>FixpunkteLV_V1_0.FixpunkteLV.LFP1->Geometrie))
                AND NOT(DMAVTYM_Topologie_V1_0.pointInPoints(THIS, >>Geometrie, ObjectPool_V1_0.filter(ObjectPool_V1_0.allObjects(>KGKCGC_FPDS2_V1_1.FPDS2.FixpunktVersion),"NOT(DEFINED(UntergegangenAm))"), >>KGKCGC_FPDS2_V1_1.FPDS2.FixpunktVersion->Geometrie))
            );
        
        END v_Messpunkt; 

    END Bodenbedeckung_Validierung;

END DMAV_V1_0_Bodenbedeckung_Validierung.
